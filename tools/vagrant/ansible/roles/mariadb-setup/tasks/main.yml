---
- name: Making MariaDB listen on {{ mariadb_bind_address }}
  lineinfile:
    dest: /etc/mysql/mariadb.conf.d/50-server.cnf
    regexp: ^bind-address
    line: "bind-address = {{ mariadb_bind_address }}"
    backrefs: yes
    state: present
    owner: root
    group: root
  notify:
    - restart mariadb

- name: Creating defined MariaDB databases
  mysql_db:
    name: "{{ item.name }}"
    encoding:  "{{ item.encoding }}"
    collation: "{{ item.collation }}"
    login_host: localhost
    login_user: root
    state: present
  with_items: "{{ mariadb_databases }}"

- name: Creating defined MariaDB users
  mysql_user:
    name: "{{ item.name }}"
    password: "{{ item.password }}"
    host: "{{ item.host }}"
    priv: "{{ item.priv }}"
    state: present
    login_host: localhost
    login_user: root
  with_items: "{{ mariadb_users }}"
  notify:
    - restart mariadb
